{% extends 'administrator/base.html' %}
{% load static %}

{% block title %}
EVEREST | ADMIN: {{ request.user.username }}
{% endblock %}

{% block content %}

<main>
  <!-- start Popup -->
  {% for message in messages %}
    {% if form.errors %}
      {% for field in form %}
        {% for error in field.errors %}
          <div class="alert alert-danger alert-dismissible"
            style="z-index: 2; background-color: #C0392B; position: absolute; margin-left: 2em; right: 2em; top: 8em;">
            <strong>{{ error|escape }}</strong>
            <button type="button" class="close btn btn-interact text-white" data-dismiss="alert"
              style="position: absolute; top:0; right: -2.7em;"><i class="far fa-times-circle fa-1x text-white"></i></button>
          </div>
        {% endfor %}
      {% endfor %}
    {% endif %}
    {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
      <p class="alert alert-danger alert-link alert-dismissible text-white"
        style="z-index: 2; background-color: #C0392B; position: absolute; margin-left: 2em; right: 2em; top: 8em;">
        {{ message }}
        <button type="button" class="close btn btn-interact" data-dismiss="alert"
          style="position: absolute; top:0; right: -2.7em;"><i class="far fa-times-circle fa-1x text-white"></i></button>
      </p>
    {% else %}
      <p class="alert alert-success alert-link alert-dismissible text-white"
        style="z-index: 2; background-color: #27AE60; position: absolute; margin-left: 2em; right: 2em; top: 8em;">
        {{message}}
        <button type="button" class="close btn btn-interact" data-dismiss="alert"
          style="position: absolute; top:0; right: -2.7em;"><i class="far fa-times-circle fa-1x text-white"></i></button>
      </p>
    {% endif %}
  {% endfor %}
  <!-- end Popup -->
  
  <!-- transactions cards -->
  <div class="container-fluid">
    <div class="row">
      <div class="col container-fluid">
        <div class="card text-white bg-success mb-3 shadow-sm rounded">
          <div class="card-header">
            <h6 class="card-title" style="font-weight: bold; text-transform: uppercase;">Approved Transactions</h6>
          </div>
          <div class="card-body d-flex">
            <i class="fas fa-clipboard-check fa-3x"></i>
            <h5 class="card-title" style="font-size: 3rem; margin-left: 1rem; font-weight: bold;">{{ approved }}</h5>
          </div>
        </div>
      </div>

      <div class="col container-fluid">
        <div class="card text-white bg-primary mb-3 shadow-sm rounded">
          <div class="card-header">
            <h6 class="card-title" style="font-weight: bold; text-transform: uppercase;">Pending Transactions</h6>
          </div>
          <div class="card-body d-flex">
            <i class="fas fa-receipt fa-3x"></i>
            <h5 class="card-title" style="font-size: 3rem; margin-left: 1rem; font-weight: bold;">{{ pending }}</h5>
          </div>
        </div>
      </div>

      <div class="col container-fluid">
        <div class="card text-white bg-danger mb-3 shadow-sm rounded">
          <div class="card-header">
            <h6 class="card-title" style="font-weight: bold; text-transform: uppercase;">Rejected Transactions</h6>
          </div>
          <div class="card-body d-flex">
            <i class="fas fa-ban fa-3x"></i>
            <h5 class="card-title" style="font-size: 3rem; margin-left: 1rem; font-weight: bold;">{{ rejected }}</h5>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- end transactions cards -->

  <!-- chart -->
  <div class="container-fluid my-2">
    <div class="row">
      <div class="card col shadow mb-3" style="border: none;">
        <script src="{% static 'js/chart.js' %}"></script>
        <canvas id="myChart" height="400%"></canvas>
        <script type="text/javascript">
          var ctx = document.getElementById('myChart').getContext('2d');
          var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
              // labels: "{{ events|safe }}".replace(/[^a-zA-Z ,.-/(/)/'!]/g, "").split(","),
              labels: [{% for event in events %} '{{ event }}', {% endfor %}],
              datasets: [
                {
                  label: 'Registered',
                  // data: "{{ registered|safe }}".replace(/[^0-9,]/g, "").split(","),
                  data: [{% for register in registered %} '{{ register }}', {% endfor %}],
                backgroundColor: [
                  '#34495E',
                ],
                },
              {
                label: 'Attended',
                  // data: "{{ attended|safe }}".replace(/[^0-9,]/g, "").split(","),
                  data: [{% for attend in attended %} '{{ attend }}', {% endfor %}],
              backgroundColor: [
                '#2ECC71',
                '#D35400',
                '#3498DB',
                '#E73C3C',
                '#F1C40F',
                '#1ABC9C',
                '#8E44AD',
                '#E67E22',
                '#27AE60',
                '#D25383'
              ],
                }
            ]
            },
            options: {
              plugins: {
                title: {
                  display: true,
                  text: 'LAST 10 EVENTS',
                  font: {
                    size: 20
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        </script>
      </div>
    </div>
  </div>
  <!-- end chart -->

  <!-- mid -->
  <div class="container-fluid my-2">
    <div class="row">
      <div class="col mb-4" style="height: 40em;">
        <div class=" container-fluid form-control shadow" style="border: none;">
          <h5 style="font-weight: bold;">RECENT TRANSACTIONS</h5>
          <hr>
          <div style="overflow-x: scroll; overflow-y: scroll; height: 34.5em; overflow:auto !important;">
            <table class="table table-striped table-hover" style="width: 100%;">
              <thead class="thead-dark" style="color: white; background-color: rgba(36, 36, 36, 0.986);">
                <tr>
                  <th scope="col">TID</th>
                  <th scope="col">MEMBER</th>
                  <th scope="col">EVENT</th>
                  <th scope="col">DATE</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                {% for transaction in recent %}
                <tr>
                  <td>{{ transaction.id }}</td>
                  <td>{{ transaction.user.user.first_name }} {{ transaction.user.user.last_name }}</td>
                  <td>{{ transaction.event.event_name }}</td>
                  <td style="text-transform: uppercase;">{{ transaction.date_created }}</td>
                  <td>
                    {% if transaction.event.cost == "PAID" %}
                    <a class="btn btn-interact btn-secondary"
                      href="/administrator/transactions/transaction/set-status/{{ transaction.id }}">SET STATUS</a>
                    {% endif %}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center">No transactions made yet.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col container-fluid" style="overflow-y: scroll; height: 38.75em; overflow:auto !important;">
        <div class="row mb-3">
          <div class="card shadow-sm">
            <div class="card-header" style="font-weight: bold; text-transform: uppercase;">
              Current Event/s
            </div>
            {% for event in today %}
            <div class="card-body">
              <h5 class="card-title">{{ event.event_name }}</h5>
              <span style="font-size: x-small; text-transform: uppercase;">{{ event.date }}</span>
              <p class="card-text">{{ event.short_description }}</p>
              <a href="/administrator/events/event/{{ event.id }}/reports" class="btn btn-info text-white" style="font-weight: bold; background-color: rgba(34, 166, 170, 0.918); border: none;">DETAILS</a>
            </div>
            {% empty %}
            <div class="card-body">
              <span><i>There no is/are no event/s currently set for today.</i></span>
            </div>
            {% endfor %}
          </div>
        </div>
        <div class="row mb-3">
          <div class="card shadow-sm">
            <div class="card-header" style="font-weight: bold; text-transform: uppercase;">
              Upcoming Event/s
            </div>
            {% for event in upcoming %}
            <div class="card-body">
              <h5 class="card-title">{{ event.event_name }}</h5>
              <span style="font-size: x-small; text-transform: uppercase;">{{ event.date }}</span>
              <p class="card-text">{{ event.short_description }}</p>
              <a href="/administrator/events/event/{{ event.id }}/reports" class="btn btn-warning text-white"
                style="font-weight: bold;">DETAILS</a>
            </div>
            {% empty %}
            <div class="card-body">
              <span><i>There are no upcoming event/s set at the moment.</i></span>
            </div>
            {% endfor %}
          </div>
        </div>
        <div class="row mb-3">
          <div class="card shadow-sm">
            <div class="card-header" style="font-weight: bold; text-transform: uppercase;">
              Previous Event/s
            </div>
            {% for event in previous %}
            <div class="card-body">
              <h5 class="card-title">{{ event.event_name }}</h5>
              <span style="font-size: x-small; text-transform: uppercase;">{{ event.date }}</span>
              <p class="card-text">{{ event.short_description }}</p>
              <a href="/administrator/events/event/{{ event.id }}/reports" class="btn btn-secondary text-white"
                style="font-weight: bold;">DETAILS</a>
            </div>
            {% empty %}
            <div class="card-body">
              <span><i>There no previous event/s held recently.</i></span>
            </div>
            {% endfor %}
          </div>
        </div>
        
      </div>

    </div>
  </div>
  <!-- end mid -->
</main>


{% endblock %}